<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cryptocurrency Analysis Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }
        
        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .input-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .input-form {
            display: flex;
            gap: 15px;
            align-items: end;
            flex-wrap: wrap;
        }
        
        .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4CAF50;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .analyze-btn {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            min-width: 150px;
        }
        
        .analyze-btn:hover {
            transform: translateY(-2px);
        }
        
        .analyze-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .loading.show {
            display: block;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .results {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            display: none;
        }
        
        .results.show {
            display: block;
        }
        
        .coin-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border-radius: 10px;
        }
        
        .coin-title {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .coin-symbol {
            font-size: 1.2em;
            opacity: 0.9;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 15px;
            border-radius: 20px;
            display: inline-block;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9ff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .section h2 {
            color: #4CAF50;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .stat-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #4CAF50;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }
        
        .positive {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .negative {
            color: #f44336;
            font-weight: bold;
        }
        
        .neutral {
            color: #666;
            font-weight: bold;
        }
        
        .analysis-section {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        
        .analysis-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            line-height: 1.6;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        
        /* Trading Levels Styling */
        .trading-section {
            background: #f0f8ff;
            border-left: 4px solid #4CAF50;
        }
        
        .stop-loss-section {
            background: #fff5f5;
            border-left: 4px solid #f44336;
        }
        
        .trading-zones-section {
            background: #f9f7ff;
            border-left: 4px solid #9c27b0;
        }
        
        .trading-levels {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .level-item {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .level-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .level-item.conservative {
            border-color: #4CAF50;
        }
        
        .level-item.moderate {
            border-color: #ff9800;
        }
        
        .level-item.aggressive {
            border-color: #f44336;
        }
        
        .level-item.stop-loss {
            border-color: #f44336;
            background: linear-gradient(145deg, #fff5f5, #ffffff);
        }
        
        .level-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .level-label {
            font-weight: 700;
            font-size: 1.1em;
            color: #333;
        }
        
        .level-price {
            font-size: 1.3em;
            font-weight: 800;
            color: #4CAF50;
        }
        
        .stop-loss .level-price {
            color: #f44336;
        }
        
        .level-details {
            display: grid;
            gap: 10px;
        }
        
        .level-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        
        .level-rationale {
            grid-column: 1 / -1;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 6px;
            font-style: italic;
            color: #666;
        }
        
        /* Trading Zones Styling */
        .zones-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .zone-item {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
            transition: transform 0.2s;
        }
        
        .zone-item:hover {
            transform: translateY(-2px);
        }
        
        .zone-item.buy-zone {
            border-color: #4CAF50;
            background: linear-gradient(145deg, #f0f8ff, #ffffff);
        }
        
        .zone-item.buy-zone.secondary {
            border-color: #ff9800;
            background: linear-gradient(145deg, #fff8e1, #ffffff);
        }
        
        .zone-item.support-resistance {
            border-color: #2196f3;
            background: linear-gradient(145deg, #f3f9ff, #ffffff);
        }
        
        .zone-item h4 {
            margin: 0 0 10px 0;
            font-size: 1.1em;
            color: #333;
        }
        
        .zone-price {
            font-size: 1.4em;
            font-weight: 800;
            color: #4CAF50;
            margin-bottom: 15px;
        }
        
        .zone-details {
            display: grid;
            gap: 8px;
        }
        
        .zone-stat {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #eee;
        }
        
        .zone-stat:last-of-type {
            border-bottom: none;
        }
        
        .zone-rationale {
            grid-column: 1 / -1;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 0.9em;
            color: #666;
            line-height: 1.4;
        }
        
        /* Key Insights Styling */
        .key-insights-section {
            background: #f8f9fa;
            border-left: 4px solid #6c63ff;
        }
        
        .insights-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        
        .insight-item {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .insight-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .insight-item.market-context {
            border-color: #2196f3;
            background: linear-gradient(145deg, #f3f9ff, #ffffff);
        }
        
        .insight-item.catalysts {
            border-color: #ff9800;
            background: linear-gradient(145deg, #fff8e1, #ffffff);
        }
        
        .insight-item.scenarios {
            border-color: #9c27b0;
            background: linear-gradient(145deg, #f9f7ff, #ffffff);
        }
        
        .insight-item h4 {
            margin: 0 0 15px 0;
            font-size: 1.2em;
            color: #333;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        
        .insight-content {
            font-size: 1em;
            line-height: 1.6;
            color: #555;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid #6c63ff;
        }
        
        .catalyst-list {
            display: grid;
            gap: 10px;
        }
        
        .catalyst-item {
            padding: 12px 15px;
            background: #f0f8ff;
            border-radius: 8px;
            border-left: 4px solid #ff9800;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        
        .catalyst-item:hover {
            background: #e3f2fd;
        }
        
        .scenarios-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .scenario {
            border-radius: 10px;
            padding: 15px;
            border: 2px solid transparent;
            transition: transform 0.2s;
        }
        
        .scenario:hover {
            transform: translateY(-1px);
        }
        
        .bull-scenario {
            background: linear-gradient(145deg, #e8f5e8, #f0fff0);
            border-color: #4CAF50;
        }
        
        .bear-scenario {
            background: linear-gradient(145deg, #ffeaea, #fff5f5);
            border-color: #f44336;
        }
        
        .scenario-header {
            margin-bottom: 10px;
        }
        
        .scenario-label {
            font-weight: 700;
            font-size: 1.1em;
            padding: 5px 12px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.7);
        }
        
        .bull-scenario .scenario-label {
            color: #2e7d32;
        }
        
        .bear-scenario .scenario-label {
            color: #c62828;
        }
        
        .scenario-content {
            font-size: 0.95em;
            line-height: 1.5;
            color: #555;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        th {
            background: #4CAF50;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        tr:hover {
            background: #f5f5f5;
        }
        
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #f44336;
            display: none;
        }
        
        .error.show {
            display: block;
        }
        
        @media (max-width: 768px) {
            .input-form {
                flex-direction: column;
            }
            
            .form-group {
                min-width: 100%;
            }
            
            .header h1 {
                font-size: 2.5em;
            }
            
            .coin-title {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 Crypto Analysis Dashboard</h1>
            <p>AI-powered cryptocurrency analysis with real-time data from CoinGecko</p>
        </div>
        
        <div class="input-section">
            <div class="input-form">
                <div class="form-group">
                    <label for="coinInput">Coin Name or Symbol</label>
                    <input type="text" id="coinInput" placeholder="e.g., bitcoin, btc, ethereum, eth" value="">
                </div>
                <div class="form-group">
                    <label for="timeframeSelect">Timeframe</label>
                    <select id="timeframeSelect">
                        <option value="daily">Daily</option>
                        <option value="weekly" selected>Weekly</option>
                        <option value="monthly">Monthly</option>
                    </select>
                </div>
                <div class="form-group">
                    <button class="analyze-btn" onclick="analyzeCoin()">
                        📈 Analyze Coin
                    </button>
                </div>
            </div>
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Analyzing cryptocurrency data... This may take a few moments.</p>
        </div>
        
        <div class="error" id="error">
            <h3>❌ Error</h3>
            <p id="errorMessage"></p>
        </div>
        
        <div class="results" id="results">
            <!-- Results will be dynamically inserted here -->
        </div>
    </div>

    <script>
        async function analyzeCoin() {
            const coinInput = document.getElementById('coinInput').value.trim();
            const timeframe = document.getElementById('timeframeSelect').value;
            
            if (!coinInput) {
                showError('Please enter a coin name or symbol');
                return;
            }
            
            // Show loading, hide results and errors
            showLoading(true);
            hideError();
            hideResults();
            
            // Disable the button
            const btn = document.querySelector('.analyze-btn');
            btn.disabled = true;
            btn.textContent = 'Analyzing...';
            
            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        coin: coinInput,
                        timeframe: timeframe
                    })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Failed to analyze coin');
                }
                
                displayResults(data);
                
            } catch (error) {
                console.error('Error:', error);
                showError(error.message || 'An error occurred while analyzing the coin');
            } finally {
                // Hide loading and re-enable button
                showLoading(false);
                btn.disabled = false;
                btn.textContent = '📈 Analyze Coin';
            }
        }
        
        function displayResults(data) {
            const resultsDiv = document.getElementById('results');
            
            // Format price change with colors
            function formatPriceChange(value) {
                if (value > 0) {
                    return `<span class="positive">+${value.toFixed(2)}%</span>`;
                } else if (value < 0) {
                    return `<span class="negative">${value.toFixed(2)}%</span>`;
                } else {
                    return `<span class="neutral">0.00%</span>`;
                }
            }
            
            // Generate historical data rows (last 5 entries)
            let historicalRows = '';
            if (data.historical_prices && data.historical_prices.length > 0) {
                const lastEntries = data.historical_prices.slice(-5);
                lastEntries.forEach(entry => {
                    historicalRows += `
                        <tr>
                            <td>${entry.date}</td>
                            <td>$${entry.price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 8})}</td>
                            <td>$${entry.volume.toLocaleString('en-US', {minimumFractionDigits: 2})}</td>
                            <td>$${entry.market_cap.toLocaleString('en-US', {minimumFractionDigits: 2})}</td>
                        </tr>
                    `;
                });
            }
            
            // Trading Analysis sections
            let tradingLevelsSection = '';
            let llmSection = '';
            
            // If we have parsed analysis data, create structured trading sections
            if (data.parsed_analysis) {
                const analysis = data.parsed_analysis;
                
                // Take Profit Levels Section
                if (analysis.take_profit_levels) {
                    const tp = analysis.take_profit_levels;
                    tradingLevelsSection += `
                        <div class="section trading-section">
                            <h2>🎯 Take Profit Levels</h2>
                            <div class="trading-levels">
                                ${tp.tp1_conservative ? `
                                <div class="level-item conservative">
                                    <div class="level-header">
                                        <span class="level-label">TP1 - Conservative</span>
                                        <span class="level-price">${tp.tp1_conservative.price}</span>
                                    </div>
                                    <div class="level-details">
                                        <div class="level-stat">
                                            <span class="stat-label">Gain:</span>
                                            <span class="stat-value positive">${tp.tp1_conservative.percentage_gain}</span>
                                        </div>
                                        <div class="level-stat">
                                            <span class="stat-label">Probability:</span>
                                            <span class="stat-value">${tp.tp1_conservative.probability}</span>
                                        </div>
                                        <div class="level-stat">
                                            <span class="stat-label">Allocation:</span>
                                            <span class="stat-value">${tp.tp1_conservative.allocation}</span>
                                        </div>
                                    </div>
                                </div>
                                ` : ''}
                                
                                ${tp.tp2_moderate ? `
                                <div class="level-item moderate">
                                    <div class="level-header">
                                        <span class="level-label">TP2 - Moderate</span>
                                        <span class="level-price">${tp.tp2_moderate.price}</span>
                                    </div>
                                    <div class="level-details">
                                        <div class="level-stat">
                                            <span class="stat-label">Gain:</span>
                                            <span class="stat-value positive">${tp.tp2_moderate.percentage_gain}</span>
                                        </div>
                                        <div class="level-stat">
                                            <span class="stat-label">Probability:</span>
                                            <span class="stat-value">${tp.tp2_moderate.probability}</span>
                                        </div>
                                        <div class="level-stat">
                                            <span class="stat-label">Allocation:</span>
                                            <span class="stat-value">${tp.tp2_moderate.allocation}</span>
                                        </div>
                                    </div>
                                </div>
                                ` : ''}
                                
                                ${tp.tp3_aggressive ? `
                                <div class="level-item aggressive">
                                    <div class="level-header">
                                        <span class="level-label">TP3 - Aggressive</span>
                                        <span class="level-price">${tp.tp3_aggressive.price}</span>
                                    </div>
                                    <div class="level-details">
                                        <div class="level-stat">
                                            <span class="stat-label">Gain:</span>
                                            <span class="stat-value positive">${tp.tp3_aggressive.percentage_gain}</span>
                                        </div>
                                        <div class="level-stat">
                                            <span class="stat-label">Probability:</span>
                                            <span class="stat-value">${tp.tp3_aggressive.probability}</span>
                                        </div>
                                        <div class="level-stat">
                                            <span class="stat-label">Allocation:</span>
                                            <span class="stat-value">${tp.tp3_aggressive.allocation}</span>
                                        </div>
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }
                
                // Stop Loss Section
                if (analysis.stop_loss) {
                    const sl = analysis.stop_loss;
                    tradingLevelsSection += `
                        <div class="section stop-loss-section">
                            <h2>🛡️ Stop Loss Levels</h2>
                            <div class="trading-levels">
                                ${sl.conservative_sl ? `
                                <div class="level-item stop-loss">
                                    <div class="level-header">
                                        <span class="level-label">Conservative Stop Loss</span>
                                        <span class="level-price">${sl.conservative_sl.price}</span>
                                    </div>
                                    <div class="level-details">
                                        <div class="level-stat">
                                            <span class="stat-label">Max Loss:</span>
                                            <span class="stat-value negative">${sl.conservative_sl.percentage_loss}</span>
                                        </div>
                                        <div class="level-rationale">
                                            <span class="stat-label">Rationale:</span>
                                            <span class="stat-value">${sl.conservative_sl.rationale}</span>
                                        </div>
                                    </div>
                                </div>
                                ` : ''}
                                
                                ${sl.moderate_sl ? `
                                <div class="level-item stop-loss">
                                    <div class="level-header">
                                        <span class="level-label">Moderate Stop Loss</span>
                                        <span class="level-price">${sl.moderate_sl.price}</span>
                                    </div>
                                    <div class="level-details">
                                        <div class="level-stat">
                                            <span class="stat-label">Max Loss:</span>
                                            <span class="stat-value negative">${sl.moderate_sl.percentage_loss}</span>
                                        </div>
                                        <div class="level-rationale">
                                            <span class="stat-label">Rationale:</span>
                                            <span class="stat-value">${sl.moderate_sl.rationale}</span>
                                        </div>
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }
                
                // Trading Zones Section
                if (analysis.trading_zones) {
                    const zones = analysis.trading_zones;
                    tradingLevelsSection += `
                        <div class="section trading-zones-section">
                            <h2>📊 Trading Zones</h2>
                            <div class="zones-grid">
                                ${zones.primary_buy_zone ? `
                                <div class="zone-item buy-zone">
                                    <h4>🟢 Primary Buy Zone</h4>
                                    <div class="zone-price">${zones.primary_buy_zone.price_range}</div>
                                    <div class="zone-details">
                                        <div class="zone-stat">
                                            <span class="stat-label">Confidence:</span>
                                            <span class="stat-value">${zones.primary_buy_zone.confidence}/10</span>
                                        </div>
                                        <div class="zone-stat">
                                            <span class="stat-label">Risk/Reward:</span>
                                            <span class="stat-value">${zones.primary_buy_zone.risk_reward_ratio}</span>
                                        </div>
                                        <div class="zone-rationale">${zones.primary_buy_zone.rationale}</div>
                                    </div>
                                </div>
                                ` : ''}
                                
                                ${zones.secondary_buy_zone ? `
                                <div class="zone-item buy-zone secondary">
                                    <h4>🟡 Secondary Buy Zone</h4>
                                    <div class="zone-price">${zones.secondary_buy_zone.price_range}</div>
                                    <div class="zone-details">
                                        <div class="zone-stat">
                                            <span class="stat-label">Confidence:</span>
                                            <span class="stat-value">${zones.secondary_buy_zone.confidence}/10</span>
                                        </div>
                                        <div class="zone-stat">
                                            <span class="stat-label">Risk/Reward:</span>
                                            <span class="stat-value">${zones.secondary_buy_zone.risk_reward_ratio}</span>
                                        </div>
                                        <div class="zone-rationale">${zones.secondary_buy_zone.rationale}</div>
                                    </div>
                                </div>
                                ` : ''}
                                
                                ${zones.key_support ? `
                                <div class="zone-item support-resistance">
                                    <h4>🔵 Key Support</h4>
                                    <div class="zone-price">${zones.key_support}</div>
                                </div>
                                ` : ''}
                                
                                ${zones.key_resistance ? `
                                <div class="zone-item support-resistance">
                                    <h4>🔴 Key Resistance</h4>
                                    <div class="zone-price">${zones.key_resistance}</div>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }
                
                // Key Insights Section
                if (analysis.key_insights) {
                    const insights = analysis.key_insights;
                    tradingLevelsSection += `
                        <div class="section key-insights-section">
                            <h2>💡 Key Market Insights</h2>
                            <div class="insights-grid">
                                ${insights.market_context ? `
                                <div class="insight-item market-context">
                                    <h4>📊 Market Context</h4>
                                    <div class="insight-content">${insights.market_context}</div>
                                </div>
                                ` : ''}
                                
                                ${insights.price_catalysts && insights.price_catalysts.length > 0 ? `
                                <div class="insight-item catalysts">
                                    <h4>🚀 Price Catalysts</h4>
                                    <div class="catalyst-list">
                                        ${insights.price_catalysts.map(catalyst => `
                                            <div class="catalyst-item">• ${catalyst}</div>
                                        `).join('')}
                                    </div>
                                </div>
                                ` : ''}
                                
                                ${insights.alternative_scenarios ? `
                                <div class="insight-item scenarios">
                                    <h4>📈📉 Market Scenarios</h4>
                                    <div class="scenarios-container">
                                        ${insights.alternative_scenarios.bull_case ? `
                                        <div class="scenario bull-scenario">
                                            <div class="scenario-header">
                                                <span class="scenario-label">🐂 Bull Case</span>
                                            </div>
                                            <div class="scenario-content">${insights.alternative_scenarios.bull_case}</div>
                                        </div>
                                        ` : ''}
                                        
                                        ${insights.alternative_scenarios.bear_case ? `
                                        <div class="scenario bear-scenario">
                                            <div class="scenario-header">
                                                <span class="scenario-label">🐻 Bear Case</span>
                                            </div>
                                            <div class="scenario-content">${insights.alternative_scenarios.bear_case}</div>
                                        </div>
                                        ` : ''}
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }
            }
            
            // Raw LLM Analysis section (fallback)
            if (data.llm_analysis) {
                llmSection = `
                    <div class="section analysis-section">
                        <h2>🤖 Raw AI Analysis</h2>
                        <div class="analysis-content">${data.llm_analysis}</div>
                    </div>
                `;
            }
            
            // Global market data section
            let globalSection = '';
            if (data.global_market_data) {
                const global = data.global_market_data;
                globalSection = `
                    <div class="section">
                        <h2>🌍 Global Market Data</h2>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-label">Total Crypto Market Cap</div>
                                <div class="stat-value">$${global.total_market_cap_usd.toLocaleString()}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Total 24h Volume</div>
                                <div class="stat-value">$${global.total_volume_24h_usd.toLocaleString()}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Bitcoin Dominance</div>
                                <div class="stat-value">${global.bitcoin_percentage.toFixed(2)}%</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Active Cryptocurrencies</div>
                                <div class="stat-value">${global.active_cryptocurrencies.toLocaleString()}</div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            resultsDiv.innerHTML = `
                <div class="coin-header">
                    <h1 class="coin-title">${data.name}</h1>
                    <div class="coin-symbol">${data.symbol}</div>
                </div>
                
                <div class="section">
                    <h2>💰 Current Market Data</h2>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">Current Price</div>
                            <div class="stat-value">$${data.current_price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 8})}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Market Cap</div>
                            <div class="stat-value">$${data.market_cap.toLocaleString()}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">24h Trading Volume</div>
                            <div class="stat-value">$${data.volume_24h.toLocaleString()}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Market Cap Rank</div>
                            <div class="stat-value">#${data.market_cap_rank}</div>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h2>🏦 Supply Information</h2>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">Circulating Supply</div>
                            <div class="stat-value">${data.circulating_supply.toLocaleString()}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Total Supply</div>
                            <div class="stat-value">${data.total_supply.toLocaleString()}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Max Supply</div>
                            <div class="stat-value">${data.max_supply ? data.max_supply.toLocaleString() : '∞'}</div>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h2>📊 Price Changes</h2>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">24h Change</div>
                            <div class="stat-value">${formatPriceChange(data.price_change_24h)}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">7d Change</div>
                            <div class="stat-value">${formatPriceChange(data.price_change_7d)}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">30d Change</div>
                            <div class="stat-value">${formatPriceChange(data.price_change_30d)}</div>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h2>🏆 All-Time Records</h2>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">All-Time High</div>
                            <div class="stat-value">$${data.ath.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 8})}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">All-Time Low</div>
                            <div class="stat-value">$${data.atl.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 8})}</div>
                        </div>
                    </div>
                </div>
                
                ${globalSection}
                
                ${tradingLevelsSection}
                
                ${historicalRows ? `
                <div class="section">
                    <h2>⏰ Recent Price History</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Date & Time</th>
                                <th>Price (USD)</th>
                                <th>Volume</th>
                                <th>Market Cap</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${historicalRows}
                        </tbody>
                    </table>
                </div>
                ` : ''}
                
                ${llmSection}
                
                <div class="section">
                    <h2>📋 Metadata</h2>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">Timeframe</div>
                            <div class="stat-value">${data.timeframe.charAt(0).toUpperCase() + data.timeframe.slice(1)}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Data Points</div>
                            <div class="stat-value">${data.data_points}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Data Source</div>
                            <div class="stat-value">${data.data_source}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Last Updated</div>
                            <div class="stat-value">${new Date(data.last_updated).toLocaleString()}</div>
                        </div>
                    </div>
                </div>
            `;
            
            showResults();
        }
        
        function showLoading(show) {
            const loading = document.getElementById('loading');
            if (show) {
                loading.classList.add('show');
            } else {
                loading.classList.remove('show');
            }
        }
        
        function showError(message) {
            const error = document.getElementById('error');
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = message;
            error.classList.add('show');
        }
        
        function hideError() {
            const error = document.getElementById('error');
            error.classList.remove('show');
        }
        
        function showResults() {
            const results = document.getElementById('results');
            results.classList.add('show');
        }
        
        function hideResults() {
            const results = document.getElementById('results');
            results.classList.remove('show');
        }
        
        // Allow Enter key to trigger analysis
        document.getElementById('coinInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                analyzeCoin();
            }
        });
    </script>
</body>
</html>